
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Code &#8212; Mood Classification of Song</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/notebooks/Spotify_project_copy';</script>
    <link rel="canonical" href="/Mood_classification_book/content/notebooks/Spotify_project_copy.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="FastAPI Code" href="FastAPI.html" />
    <link rel="prev" title="Code Files" href="../code_section.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Mood Classification of Song</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Mood Classification Project
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../resume.html">Resume</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../code_section.html">Code Files</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Code</a></li>














<li class="toctree-l2"><a class="reference internal" href="FastAPI.html">FastAPI Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="Streamlit.html">StreamLit Code</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../links.html">Important Links</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/ShahaDeven/Mood_classification_book" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/notebooks/Spotify_project_copy.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Code</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Code</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#to-fetch-inital-1k-songs">To fetch inital 1k songs</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-output-of-data-being-fetched">Sample Output of Data Being Fetched</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#to-fetch-remaining-9k-songs">to fetch remaining 9k songs</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Sample Output of Data Being Fetched</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-songs">Merge songs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sqlite3-connection">SQLITE3 Connection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-schema">Table schema</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nf">3NF</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#yprofiling">YProfiling</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dagshub">DagsHUB</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-1">Experiment 1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-2">Experiment 2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-3">Experiment 3</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-4">Experiment 4</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#expermient-5">Expermient 5</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-6">Experiment 6</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-7">Experiment 7</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#f1-score-plots">F1 Score Plots</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-model-using-joblib">Save model using joblib</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="code">
<h1>Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">ydata_profiling</span> <span class="kn">import</span> <span class="n">ProfileReport</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">dagshub</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span><span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span><span class="n">GradientBoostingClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span><span class="n">LabelEncoder</span><span class="p">,</span> <span class="n">FunctionTransformer</span><span class="p">,</span><span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">make_scorer</span><span class="p">,</span><span class="n">multilabel_confusion_matrix</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span><span class="p">,</span> <span class="n">SelectFromModel</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">StackingClassifier</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s1">&#39;2d4d3eb91ee343dcb255dfd55e8e6fa3&#39;</span>
<span class="n">CLIENT_SECRET</span> <span class="o">=</span> <span class="s1">&#39;5c2e8a504db042d9b35590298560d70e&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_access_token</span><span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://accounts.spotify.com/api/token&quot;</span>
    
    <span class="c1"># Manually encode the client_id and client_secret</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">client_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">client_secret</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">encoded_credentials</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Basic </span><span class="si">{</span><span class="n">encoded_credentials</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;client_credentials&quot;</span><span class="p">}</span>
    
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># Check for errors</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed to get access token. Check your client credentials.&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;access_token&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token_repeat</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;New Access Token:&quot;</span><span class="p">,</span> <span class="n">access_token_repeat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>New Access Token: BQBxXOIgF1jkb1bKLAcyHN2PKWeMtkgMdFY-G7HffGzSopaFsCAtVuHE1Z8cpHyL9VdZngq99j-U-1YjR1dafXAgFAxfPa5OPyN3LNO-YVTkuYMEEjA
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_spotify_categories</span><span class="p">(</span><span class="n">access_token</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spotify.com/v1/browse/categories&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">}</span>
    
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Extract categories (genres) from the response</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;categories&quot;</span><span class="p">][</span><span class="s2">&quot;items&quot;</span><span class="p">]</span>
        <span class="n">genre_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">category</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">categories</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">genre_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">genres</span> <span class="o">=</span> <span class="n">get_spotify_categories</span><span class="p">(</span><span class="n">access_token_repeat</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Genres/Category List:&quot;</span><span class="p">,</span> <span class="n">genres</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Genres/Category List: [&#39;2024 in Music&#39;, &#39;Made For You&#39;, &#39;New Releases&#39;, &#39;Happy Holidays&#39;, &#39;Hip-Hop&#39;, &#39;Country&#39;, &#39;Pop&#39;, &#39;Charts&#39;, &#39;Latin&#39;, &#39;Student&#39;, &#39;Discover&#39;, &#39;Rock&#39;, &#39;Dance/Electronic&#39;, &#39;In the car&#39;, &#39;Mood&#39;, &#39;Indie&#39;, &#39;R&amp;B&#39;, &#39;Christian &amp; Gospel&#39;, &#39;Workout&#39;, &#39;Disney&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="to-fetch-inital-1k-songs">
<h1>To fetch inital 1k songs<a class="headerlink" href="#to-fetch-inital-1k-songs" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">fetch_songs</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">total_songs</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
    <span class="n">all_songs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">genre_offsets</span> <span class="o">=</span> <span class="p">{</span><span class="n">genre</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">genre</span> <span class="ow">in</span> <span class="n">genres</span><span class="p">}</span>  
    <span class="n">fetched_song_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> 

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_songs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">total_songs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">genre</span> <span class="ow">in</span> <span class="n">genres</span><span class="p">:</span>
            <span class="n">songs_needed</span> <span class="o">=</span> <span class="n">total_songs</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_songs</span><span class="p">)</span>
            <span class="n">fetch_limit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">songs_needed</span><span class="p">)</span>

            <span class="n">offset</span> <span class="o">=</span> <span class="n">genre_offsets</span><span class="p">[</span><span class="n">genre</span><span class="p">]</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/search?q=</span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s2">&amp;type=track&amp;limit=</span><span class="si">{</span><span class="n">fetch_limit</span><span class="si">}</span><span class="s2">&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">tracks</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tracks&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span>

                <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>
                    <span class="n">song_id</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">song_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fetched_song_ids</span><span class="p">:</span>
                        <span class="n">artist_id</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                        <span class="n">album_id</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                        <span class="n">song</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;song_id&quot;</span><span class="p">:</span> <span class="n">song_id</span><span class="p">,</span>
                            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;artist&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;artist_id&quot;</span><span class="p">:</span> <span class="n">artist_id</span><span class="p">,</span>
                            <span class="s2">&quot;album&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;album_id&quot;</span><span class="p">:</span> <span class="n">album_id</span><span class="p">,</span>
                            <span class="s2">&quot;release_date&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;release_date&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;duration_ms&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="n">genre</span>
                        <span class="p">}</span>
                        <span class="n">all_songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
                        <span class="n">fetched_song_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">song_id</span><span class="p">)</span>  

                <span class="n">genre_offsets</span><span class="p">[</span><span class="n">genre</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fetch_limit</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fetch_limit</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No more songs available for genre: </span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">genres</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">genre</span><span class="p">)</span>
                    <span class="k">break</span>

            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>  
                <span class="n">retry_after</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limit exceeded. Retrying after </span><span class="si">{</span><span class="n">retry_after</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching songs for genre: </span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s2">, Status Code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">genres</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All genres exhausted. Ending process.&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">all_songs</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_songs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>
<span class="n">genres</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pop&quot;</span><span class="p">,</span> <span class="s2">&quot;rock&quot;</span><span class="p">,</span> <span class="s2">&quot;jazz&quot;</span><span class="p">,</span> <span class="s2">&quot;Electronic&quot;</span><span class="p">,</span> <span class="s2">&quot;Indie&quot;</span><span class="p">]</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">50</span>  
<span class="n">total_songs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;songs_1.json&quot;</span>

<span class="n">fetch_songs</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">total_songs</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="sample-output-of-data-being-fetched">
<h2>Sample Output of Data Being Fetched<a class="headerlink" href="#sample-output-of-data-being-fetched" title="Link to this heading">#</a></h2>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;song_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;57Pk2GU0ABFYBbbcgYxqki&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Popular - From \&quot;Wicked\&quot; Original Broadway Cast Recording/2003&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;artist&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Stephen Schwartz&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;artist_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7daPb40K64rRtF36wd3ZOk&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;album&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Wicked (Original Broadway Cast Recording / Deluxe Edition)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;album_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1woCvthHJakakroP6dXNxs&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;release_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2013-01-01&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;duration_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">224386</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;genre&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pop&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;song_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6WzRpISELf3YglGAh7TXcG&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Popular (with Playboi Carti &amp; Madonna) - From The Idol Vol. 1 (Music from the HBO Original Series)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;artist&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The Weeknd&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;artist_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1Xyo4u8uXC1ZmMpatF05PJ&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;album&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Popular (Music from the HBO Original Series)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;album_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5O0zUvdnJr0RbWzLFneN2i&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;release_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-06-02&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;duration_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">215466</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;genre&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pop&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="to-fetch-remaining-9k-songs">
<h1>to fetch remaining 9k songs<a class="headerlink" href="#to-fetch-remaining-9k-songs" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fetch_new_songs</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">total_songs</span><span class="p">,</span> <span class="n">previous_songs_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
    <span class="c1"># Load previously fetched songs</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">previous_songs_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">previous_songs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
    <span class="n">previous_song_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">previous_songs</span><span class="p">}</span>

    <span class="n">new_songs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">genre_offsets</span> <span class="o">=</span> <span class="p">{</span><span class="n">genre</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">genre</span> <span class="ow">in</span> <span class="n">genres</span><span class="p">}</span>  
    <span class="n">fetched_song_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">previous_song_ids</span><span class="p">)</span>  

    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_songs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">total_songs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">genre</span> <span class="ow">in</span> <span class="n">genres</span><span class="p">:</span>
            <span class="n">songs_needed</span> <span class="o">=</span> <span class="n">total_songs</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_songs</span><span class="p">)</span>
            <span class="n">fetch_limit</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">songs_needed</span><span class="p">)</span>

            <span class="n">offset</span> <span class="o">=</span> <span class="n">genre_offsets</span><span class="p">[</span><span class="n">genre</span><span class="p">]</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/search?q=</span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s2">&amp;type=track&amp;limit=</span><span class="si">{</span><span class="n">fetch_limit</span><span class="si">}</span><span class="s2">&amp;offset=</span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">tracks</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tracks&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span>

                <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">tracks</span><span class="p">:</span>
                    <span class="n">song_id</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">song_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fetched_song_ids</span><span class="p">:</span>
                        <span class="n">artist_id</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                        <span class="n">album_id</span> <span class="o">=</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                        <span class="n">song</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;song_id&quot;</span><span class="p">:</span> <span class="n">song_id</span><span class="p">,</span>
                            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;artist&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;artist_id&quot;</span><span class="p">:</span> <span class="n">artist_id</span><span class="p">,</span>
                            <span class="s2">&quot;album&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;album_id&quot;</span><span class="p">:</span> <span class="n">album_id</span><span class="p">,</span>
                            <span class="s2">&quot;release_date&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;album&quot;</span><span class="p">][</span><span class="s2">&quot;release_date&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="n">track</span><span class="p">[</span><span class="s2">&quot;duration_ms&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="n">genre</span>
                        <span class="p">}</span>
                        <span class="n">new_songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
                        <span class="n">fetched_song_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">song_id</span><span class="p">)</span> 

                <span class="n">genre_offsets</span><span class="p">[</span><span class="n">genre</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fetch_limit</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tracks</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">fetch_limit</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No more songs available for genre: </span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">genres</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">genre</span><span class="p">)</span>
                    <span class="k">break</span>

            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
                <span class="n">retry_after</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limit exceeded. Retrying after </span><span class="si">{</span><span class="n">retry_after</span><span class="si">}</span><span class="s2"> seconds...&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching songs for genre: </span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s2">, Status Code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">genres</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All genres exhausted. Ending process.&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">new_songs</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New unique songs saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_songs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>
<span class="n">genres</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hard-rock&quot;</span><span class="p">,</span> <span class="s2">&quot;death-metal&quot;</span><span class="p">,</span> <span class="s2">&quot;disco&quot;</span><span class="p">,</span> <span class="s2">&quot;anime&quot;</span><span class="p">,</span> <span class="s2">&quot;holidays&quot;</span><span class="p">]</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">50</span>  
<span class="n">total_songs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">previous_songs_file</span> <span class="o">=</span> <span class="s2">&quot;songs_merged_final.json&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;songs_6.json&quot;</span>

<span class="n">fetch_new_songs</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">total_songs</span><span class="p">,</span> <span class="n">previous_songs_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h2>Sample Output of Data Being Fetched<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;song_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0QrjkDvH06SKE8LXq3VTA3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hard Rock Bottom of Your Heart&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;artist&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Randy Travis&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;artist_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1pTuR132U5b4Rizal2Pr7m&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;album&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;On the Other Hand - All the Number Ones&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;album_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0UCCMRZib7d6eCdEWQiPJ3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;release_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2015-04-21&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;duration_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">237013</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;genre&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hard-rock&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;song_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5jhI9kdseTMJQYvjIm5MVU&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bleh&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;artist&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hardrock&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;artist_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1EM110Ljwqga6grZH2Dym3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;album&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1of1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;album_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1uDRSDtUULUbusMjtRrwKi&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;release_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2023-08-18&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;duration_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">146750</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;genre&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hard-rock&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="merge-songs">
<h1>Merge songs<a class="headerlink" href="#merge-songs" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge_song_files</span><span class="p">(</span><span class="n">file1</span><span class="p">,</span> <span class="n">file2</span><span class="p">,</span> <span class="n">merged_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file1</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f1</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">file2</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
        <span class="n">songs1</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
        <span class="n">songs2</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>

    <span class="n">song_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs1</span><span class="p">}</span>  
    <span class="n">merged_songs</span> <span class="o">=</span> <span class="n">songs1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">song_ids</span><span class="p">:</span>
            <span class="n">merged_songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
            <span class="n">song_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">])</span>
    
    <span class="c1"># Save the merged songs to the new merged file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">merged_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">merged_songs</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merged songs saved to </span><span class="si">{</span><span class="n">merged_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">merged_songs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_song_files</span><span class="p">(</span><span class="s2">&quot;songs_1.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_2.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_merged.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>
<span class="n">genres</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hard-rock&quot;</span><span class="p">,</span> <span class="s2">&quot;death-metal&quot;</span><span class="p">,</span> <span class="s2">&quot;disco&quot;</span><span class="p">,</span> <span class="s2">&quot;anime&quot;</span><span class="p">,</span> <span class="s2">&quot;holidays&quot;</span><span class="p">]</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">50</span>  
<span class="n">total_songs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">previous_songs_file</span> <span class="o">=</span> <span class="s2">&quot;songs_6.json&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;songs_7.json&quot;</span>

<span class="n">fetch_new_songs</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">total_songs</span><span class="p">,</span> <span class="n">previous_songs_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_song_files</span><span class="p">(</span><span class="s2">&quot;songs_6.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_7.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_merged_3.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>
<span class="n">genres</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hard-rock&quot;</span><span class="p">,</span> <span class="s2">&quot;death-metal&quot;</span><span class="p">,</span> <span class="s2">&quot;disco&quot;</span><span class="p">,</span> <span class="s2">&quot;anime&quot;</span><span class="p">,</span> <span class="s2">&quot;holidays&quot;</span><span class="p">]</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">50</span>  
<span class="n">total_songs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">previous_songs_file</span> <span class="o">=</span> <span class="s2">&quot;songs_merged_3.json&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;songs_8.json&quot;</span>

<span class="n">fetch_new_songs</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">total_songs</span><span class="p">,</span> <span class="n">previous_songs_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_song_files</span><span class="p">(</span><span class="s2">&quot;songs_merged_3.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_8.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_merged_4.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>
<span class="n">genres</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hard-rock&quot;</span><span class="p">,</span> <span class="s2">&quot;death-metal&quot;</span><span class="p">,</span> <span class="s2">&quot;disco&quot;</span><span class="p">,</span> <span class="s2">&quot;anime&quot;</span><span class="p">,</span> <span class="s2">&quot;holidays&quot;</span><span class="p">]</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">50</span>  
<span class="n">total_songs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">previous_songs_file</span> <span class="o">=</span> <span class="s2">&quot;songs_merged_4.json&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;songs_9.json&quot;</span>

<span class="n">fetch_new_songs</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">total_songs</span><span class="p">,</span> <span class="n">previous_songs_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_song_files</span><span class="p">(</span><span class="s2">&quot;songs_merged_4.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_9.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_merged_5.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>
<span class="n">genres</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hard-rock&quot;</span><span class="p">,</span> <span class="s2">&quot;death-metal&quot;</span><span class="p">,</span> <span class="s2">&quot;disco&quot;</span><span class="p">,</span> <span class="s2">&quot;anime&quot;</span><span class="p">,</span> <span class="s2">&quot;holidays&quot;</span><span class="p">]</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">50</span>  
<span class="n">total_songs</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">previous_songs_file</span> <span class="o">=</span> <span class="s2">&quot;songs_merged_5.json&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;songs_10.json&quot;</span>

<span class="n">fetch_new_songs</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">genres</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">total_songs</span><span class="p">,</span> <span class="n">previous_songs_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_song_files</span><span class="p">(</span><span class="s2">&quot;songs_merged_5.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_10.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_merged_6.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_song_files</span><span class="p">(</span><span class="s2">&quot;songs_merged_final.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_merged_6.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_merged_final_new.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge_multiple_song_files</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">merged_file</span><span class="p">):</span>
    <span class="n">merged_songs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">song_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">songs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">song_ids</span><span class="p">:</span>
                <span class="n">merged_songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
                <span class="n">song_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">])</span>
    
    <span class="c1"># Save the merged songs to the new merged file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">merged_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">merged_songs</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merged songs saved to </span><span class="si">{</span><span class="n">merged_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">merged_songs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files_to_merge</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;songs_6.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_7.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_8.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_9.json&quot;</span><span class="p">,</span> <span class="s2">&quot;songs_10.json&quot;</span><span class="p">]</span>
<span class="n">merged_file</span> <span class="o">=</span> <span class="s2">&quot;merged_songs_new_genres.json&quot;</span>

<span class="n">merged_songs</span> <span class="o">=</span> <span class="n">merge_multiple_song_files</span><span class="p">(</span><span class="n">files_to_merge</span><span class="p">,</span> <span class="n">merged_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Merged songs saved to merged_songs_new_genres.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fetch_artist_details_batch</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">artist_ids</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spotify.com/v1/artists&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="n">artists</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">artist_id</span> <span class="ow">in</span> <span class="n">artist_ids</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">artist_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">artist_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">artist</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;artist_id&quot;</span><span class="p">:</span> <span class="n">artist_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">artist_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;popularity&quot;</span><span class="p">:</span> <span class="n">artist_data</span><span class="p">[</span><span class="s2">&quot;popularity&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;genres&quot;</span><span class="p">:</span> <span class="n">artist_data</span><span class="p">[</span><span class="s2">&quot;genres&quot;</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="n">artists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span> 
                <span class="n">retry_after</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limited. Retrying after </span><span class="si">{</span><span class="n">retry_after</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching artist: </span><span class="si">{</span><span class="n">artist_id</span><span class="si">}</span><span class="s2">, Status Code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">return</span> <span class="n">artists</span>


<span class="k">def</span> <span class="nf">save_artist_data_to_json</span><span class="p">(</span><span class="n">artists</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;artist_data.json&quot;</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">artists</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Artist data saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fetch_album_details_batch</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">album_ids</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/albums&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="n">albums</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">album_id</span> <span class="ow">in</span> <span class="n">album_ids</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">album_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">album_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">album</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;album_id&quot;</span><span class="p">:</span> <span class="n">album_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">album_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;release_date&quot;</span><span class="p">:</span> <span class="n">album_data</span><span class="p">[</span><span class="s2">&quot;release_date&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;total_tracks&quot;</span><span class="p">:</span> <span class="n">album_data</span><span class="p">[</span><span class="s2">&quot;total_tracks&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;artist_id&quot;</span><span class="p">:</span> <span class="n">album_data</span><span class="p">[</span><span class="s2">&quot;artists&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="n">albums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">album</span><span class="p">)</span>
                <span class="k">break</span>  
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>  
                <span class="n">retry_after</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limited. Retrying after </span><span class="si">{</span><span class="n">retry_after</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching album: </span><span class="si">{</span><span class="n">album_id</span><span class="si">}</span><span class="s2">, Status Code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>  

    <span class="k">return</span> <span class="n">albums</span>

<span class="k">def</span> <span class="nf">save_album_data_to_json</span><span class="p">(</span><span class="n">albums</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">albums</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Album data saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fetch_audio_features_batch</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">song_ids</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch audio features for songs in batches of 100 to avoid exceeding Spotify&#39;s limit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.spotify.com/v1/audio-features&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="n">audio_features</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Batch the song IDs into chunks of 100</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">song_ids</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">batch_ids</span> <span class="o">=</span> <span class="n">song_ids</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ids&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">batch_ids</span><span class="p">)}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">features_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;audio_features&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">for</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">features_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">features</span><span class="p">:</span>  <span class="c1"># Skip if features are `null`</span>
                    <span class="n">audio_features</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;song_id&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;danceability&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;danceability&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;energy&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;loudness&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;loudness&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;tempo&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;tempo&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;time_signature&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;time_signature&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;instrumentalness&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;instrumentalness&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;liveness&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;liveness&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;valence&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;valence&quot;</span><span class="p">],</span>
                    <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching audio features for batch </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">batch_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: Status Code </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">audio_features</span>

<span class="k">def</span> <span class="nf">save_audio_features_to_json</span><span class="p">(</span><span class="n">audio_features</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the audio features to a JSON file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">audio_features</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Audio features data saved to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;merged_songs_new_genres.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">songs_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">artist_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;artist_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs_data</span><span class="p">})</span>

<span class="n">artists</span> <span class="o">=</span> <span class="n">fetch_artist_details_batch</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">artist_ids</span><span class="p">)</span>

<span class="n">save_artist_data_to_json</span><span class="p">(</span><span class="n">artists</span><span class="p">,</span> <span class="s2">&quot;artist_data_new_genre.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Artist data saved to artist_data_new_genre.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;merged_songs_new_genres.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">songs_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">album_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;album_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs_data</span><span class="p">})</span>

<span class="n">albums</span> <span class="o">=</span> <span class="n">fetch_album_details_batch</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">album_ids</span><span class="p">)</span>
<span class="n">save_album_data_to_json</span><span class="p">(</span><span class="n">albums</span><span class="p">,</span><span class="s1">&#39;album_data_new_genre.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Album data saved to album_data_new_genre.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">access_token</span> <span class="o">=</span> <span class="n">get_access_token</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span> <span class="n">CLIENT_SECRET</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;songs_merged_final.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">songs_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">song_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs_data</span><span class="p">})</span> 

<span class="n">audio_features</span> <span class="o">=</span> <span class="n">fetch_audio_features_batch</span><span class="p">(</span><span class="n">access_token</span><span class="p">,</span> <span class="n">song_ids</span><span class="p">)</span>
<span class="n">save_audio_features_to_json</span><span class="p">(</span><span class="n">audio_features</span><span class="p">,</span><span class="s1">&#39;audio_features_data_new_audio.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Audio features data saved to audio_features_data_new_audio.json
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;artist_data.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file1</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;artist_data_new_genre.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file2</span><span class="p">:</span>
    <span class="n">songs1</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>
    <span class="n">songs2</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>

<span class="c1"># Use a set to track unique song IDs</span>
<span class="n">artist_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">artist</span><span class="p">[</span><span class="s2">&quot;artist_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">songs1</span><span class="p">}</span>

<span class="c1"># Merge songs without duplicates</span>
<span class="n">merged_songs</span> <span class="o">=</span> <span class="n">songs1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs2</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;artist_id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">artist_ids</span><span class="p">:</span>
        <span class="n">merged_songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
        <span class="n">artist_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;artist_id&quot;</span><span class="p">])</span>

<span class="c1"># Save the merged JSON to a new file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;artist_data_merged_new.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">merged_songs</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Songs merged successfully without duplicates!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Songs merged successfully without duplicates!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;album_data.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file1</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;album_data_new_genre.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file2</span><span class="p">:</span>
    <span class="n">songs1</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>
    <span class="n">songs2</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>

<span class="c1"># Use a set to track unique song IDs</span>
<span class="n">album_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">album</span><span class="p">[</span><span class="s2">&quot;album_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">album</span> <span class="ow">in</span> <span class="n">songs1</span><span class="p">}</span>

<span class="c1"># Merge songs without duplicates</span>
<span class="n">merged_songs</span> <span class="o">=</span> <span class="n">songs1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs2</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;album_id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">album_ids</span><span class="p">:</span>
        <span class="n">merged_songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
        <span class="n">album_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;album_id&quot;</span><span class="p">])</span>

<span class="c1"># Save the merged JSON to a new file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;album_data_merged_new.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">merged_songs</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Songs merged successfully without duplicates!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Songs merged successfully without duplicates!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;audio_features_data_new_audio.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file1</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;audio_features_data_new_genre.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file2</span><span class="p">:</span>
    <span class="n">songs1</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>
    <span class="n">songs2</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>

<span class="c1"># Use a set to track unique song IDs</span>
<span class="n">song_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs1</span><span class="p">}</span>

<span class="c1"># Merge songs without duplicates</span>
<span class="n">merged_songs</span> <span class="o">=</span> <span class="n">songs1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs2</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">song_ids</span><span class="p">:</span>
        <span class="n">merged_songs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">song</span><span class="p">)</span>
        <span class="n">song_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">])</span>

<span class="c1"># Save the merged JSON to a new file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;audio_features_data_merged_new.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">merged_songs</span><span class="p">,</span> <span class="n">output_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Songs merged successfully without duplicates!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Songs merged successfully without duplicates!
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="sqlite3-connection">
<h1>SQLITE3 Connection<a class="headerlink" href="#sqlite3-connection" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;spotify_data.db&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># conn.close()</span>
</pre></div>
</div>
</div>
</div>
<section id="table-schema">
<h2>Table schema<a class="headerlink" href="#table-schema" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE IF NOT EXISTS artists (</span>
<span class="s2">    artist_id TEXT PRIMARY KEY,</span>
<span class="s2">    name TEXT NOT NULL,</span>
<span class="s2">    popularity INTEGER,</span>
<span class="s2">    genres TEXT</span>
<span class="s2">);</span>

<span class="s2">CREATE TABLE IF NOT EXISTS albums (</span>
<span class="s2">    album_id TEXT PRIMARY KEY,</span>
<span class="s2">    name TEXT NOT NULL,</span>
<span class="s2">    release_date TEXT,</span>
<span class="s2">    total_tracks INTEGER,</span>
<span class="s2">    artist_id TEXT NOT NULL,</span>
<span class="s2">    FOREIGN KEY (artist_id) REFERENCES artists(artist_id)</span>
<span class="s2">);</span>

<span class="s2">CREATE TABLE songs (</span>
<span class="s2">    song_id TEXT PRIMARY KEY,</span>
<span class="s2">    title TEXT NOT NULL,</span>
<span class="s2">    artist_id TEXT NOT NULL,</span>
<span class="s2">    album_id TEXT NOT NULL,</span>
<span class="s2">    release_date TEXT,</span>
<span class="s2">    duration_ms INTEGER,</span>
<span class="s2">    genre TEXT,</span>
<span class="s2">    FOREIGN KEY (artist_id) REFERENCES artists (artist_id),</span>
<span class="s2">    FOREIGN KEY (album_id) REFERENCES albums (album_id)</span>
<span class="s2">);</span>


<span class="s2">CREATE TABLE IF NOT EXISTS audio_features (</span>
<span class="s2">    song_id TEXT PRIMARY KEY,</span>
<span class="s2">    danceability REAL,</span>
<span class="s2">    energy REAL,</span>
<span class="s2">    key INTEGER,</span>
<span class="s2">    loudness REAL,</span>
<span class="s2">    tempo REAL,</span>
<span class="s2">    time_signature INTEGER,</span>
<span class="s2">    instrumentalness REAL,</span>
<span class="s2">    liveness REAL,</span>
<span class="s2">    valence REAL,</span>
<span class="s2">    FOREIGN KEY (song_id) REFERENCES songs(song_id)</span>
<span class="s2">);</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sqlite3.Cursor at 0x1cd592f3cc0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># tables_to_drop = [&quot;artists&quot;, &quot;albums&quot;, &quot;songs&quot;, &quot;audio_features&quot;]</span>

<span class="c1"># # Loop through each table and drop it</span>
<span class="c1"># for table in tables_to_drop:</span>
<span class="c1">#     try:</span>
<span class="c1">#         cursor.execute(f&quot;DROP TABLE IF EXISTS {table}&quot;)</span>
<span class="c1">#         print(f&quot;Table &#39;{table}&#39; dropped successfully.&quot;)</span>
<span class="c1">#     except sqlite3.Error as e:</span>
<span class="c1">#         print(f&quot;Error dropping table &#39;{table}&#39;: {e}&quot;)</span>

<span class="c1"># # Commit changes and close connection</span>
<span class="c1"># conn.commit()</span>
<span class="c1"># conn.close()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Table &#39;artists&#39; dropped successfully.
Table &#39;albums&#39; dropped successfully.
Table &#39;songs&#39; dropped successfully.
Table &#39;audio_features&#39; dropped successfully.
</pre></div>
</div>
</div>
</div>
</section>
<section id="nf">
<h2>3NF<a class="headerlink" href="#nf" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;songs_merged_final_new.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">songs_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;artist_data_merged_new.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">artists_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;album_data_merged_new.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">albums_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;audio_features_data_merged_new.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">audio_features_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    INSERT OR IGNORE INTO artists (artist_id, name, popularity, genres)</span>
<span class="s2">    VALUES (?, ?, ?, ?)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">artist</span><span class="p">[</span><span class="s2">&quot;artist_id&quot;</span><span class="p">],</span> <span class="n">artist</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">artist</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;popularity&quot;</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">artist</span><span class="p">[</span><span class="s2">&quot;genres&quot;</span><span class="p">]))</span> <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">artists_data</span><span class="p">])</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    INSERT OR IGNORE INTO albums (album_id, name, release_date,total_tracks, artist_id)</span>
<span class="s2">    VALUES (?, ?, ?, ?, ?)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">album</span><span class="p">[</span><span class="s2">&quot;album_id&quot;</span><span class="p">],</span> <span class="n">album</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span> <span class="n">album</span><span class="p">[</span><span class="s2">&quot;release_date&quot;</span><span class="p">],</span> <span class="n">album</span><span class="p">[</span><span class="s2">&quot;total_tracks&quot;</span><span class="p">],</span><span class="n">album</span><span class="p">[</span><span class="s2">&quot;artist_id&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">album</span> <span class="ow">in</span> <span class="n">albums_data</span><span class="p">])</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    INSERT OR IGNORE INTO songs (song_id, title, artist_id, album_id, release_date, duration_ms, genre)</span>
<span class="s2">    VALUES (?, ?, ?, ?, ?, ?, ?)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">(</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">],</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;artist_id&quot;</span><span class="p">],</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;album_id&quot;</span><span class="p">],</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;release_date&quot;</span><span class="p">],</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;duration_ms&quot;</span><span class="p">],</span>
        <span class="n">song</span><span class="p">[</span><span class="s2">&quot;genre&quot;</span><span class="p">]</span>
    <span class="p">)</span> <span class="k">for</span> <span class="n">song</span> <span class="ow">in</span> <span class="n">songs_data</span>
<span class="p">])</span>


<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    INSERT OR IGNORE INTO audio_features (song_id, danceability, energy, key, loudness, tempo, time_signature, instrumentalness, liveness, valence)</span>
<span class="s2">    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">feature</span><span class="p">[</span><span class="s2">&quot;song_id&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;danceability&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;loudness&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;tempo&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;time_signature&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;instrumentalness&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;liveness&quot;</span><span class="p">],</span> <span class="n">feature</span><span class="p">[</span><span class="s2">&quot;valence&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">audio_features_data</span><span class="p">])</span>

<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;spotify_data.db&quot;</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT </span>
<span class="s2">    s.song_id,</span>
<span class="s2">    s.title,</span>
<span class="s2">    a.name AS artist_name,</span>
<span class="s2">    al.name AS album_name,</span>
<span class="s2">    s.release_date,</span>
<span class="s2">    s.duration_ms,</span>
<span class="s2">    s.genre,</span>
<span class="s2">    af.danceability,</span>
<span class="s2">    af.energy,</span>
<span class="s2">    af.key,</span>
<span class="s2">    af.loudness,</span>
<span class="s2">    af.tempo,</span>
<span class="s2">    af.time_signature,</span>
<span class="s2">    af.instrumentalness,</span>
<span class="s2">    af.liveness,</span>
<span class="s2">    af.valence</span>
<span class="s2">FROM songs s</span>
<span class="s2">JOIN artists a ON s.artist_id = a.artist_id</span>
<span class="s2">JOIN albums al ON s.album_id = al.album_id</span>
<span class="s2">JOIN audio_features af ON s.song_id = af.song_id</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>

<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>song_id</th>
      <th>title</th>
      <th>artist_name</th>
      <th>album_name</th>
      <th>release_date</th>
      <th>duration_ms</th>
      <th>genre</th>
      <th>danceability</th>
      <th>energy</th>
      <th>key</th>
      <th>loudness</th>
      <th>tempo</th>
      <th>time_signature</th>
      <th>instrumentalness</th>
      <th>liveness</th>
      <th>valence</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>57Pk2GU0ABFYBbbcgYxqki</td>
      <td>Popular - From "Wicked" Original Broadway Cast...</td>
      <td>Stephen Schwartz</td>
      <td>Wicked (Original Broadway Cast Recording / Del...</td>
      <td>2013-01-01</td>
      <td>224386</td>
      <td>pop</td>
      <td>0.711</td>
      <td>0.2280</td>
      <td>0</td>
      <td>-12.850</td>
      <td>88.714</td>
      <td>4</td>
      <td>0.000000</td>
      <td>0.1220</td>
      <td>0.5480</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6WzRpISELf3YglGAh7TXcG</td>
      <td>Popular (with Playboi Carti &amp; Madonna) - From ...</td>
      <td>The Weeknd</td>
      <td>Popular (Music from the HBO Original Series)</td>
      <td>2023-06-02</td>
      <td>215466</td>
      <td>pop</td>
      <td>0.854</td>
      <td>0.6740</td>
      <td>1</td>
      <td>-6.230</td>
      <td>99.022</td>
      <td>4</td>
      <td>0.000085</td>
      <td>0.5090</td>
      <td>0.8480</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6z3HAUZpAyJ0ctsbAwAiw3</td>
      <td>Pop Muzik</td>
      <td>M</td>
      <td>Pop Muzik</td>
      <td>2022-06-03</td>
      <td>200682</td>
      <td>pop</td>
      <td>0.935</td>
      <td>0.8330</td>
      <td>1</td>
      <td>-7.493</td>
      <td>108.914</td>
      <td>4</td>
      <td>0.000016</td>
      <td>0.0792</td>
      <td>0.9670</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6uFn47ACjqYkc0jADwEdj1</td>
      <td>Pop Out (feat. Lil Tjay)</td>
      <td>Polo G</td>
      <td>Die A Legend</td>
      <td>2019-06-07</td>
      <td>166560</td>
      <td>pop</td>
      <td>0.772</td>
      <td>0.6390</td>
      <td>1</td>
      <td>-7.119</td>
      <td>168.112</td>
      <td>4</td>
      <td>0.000000</td>
      <td>0.0698</td>
      <td>0.2610</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4GssB27iJeqmfGxS94Tfij</td>
      <td>Popular Monster</td>
      <td>Falling In Reverse</td>
      <td>Popular Monster</td>
      <td>2019-11-20</td>
      <td>220537</td>
      <td>pop</td>
      <td>0.461</td>
      <td>0.8970</td>
      <td>3</td>
      <td>-3.982</td>
      <td>165.107</td>
      <td>4</td>
      <td>0.000000</td>
      <td>0.0965</td>
      <td>0.3580</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9969</th>
      <td>4FmUrmRianI41BlO2RYhew</td>
      <td>She Was Here, Alone (From "Erased")</td>
      <td>LucasPianoRoom</td>
      <td>Anime Piano, Vol. 2</td>
      <td>2020-04-02</td>
      <td>140945</td>
      <td>anime</td>
      <td>0.442</td>
      <td>0.0593</td>
      <td>4</td>
      <td>-19.093</td>
      <td>62.987</td>
      <td>3</td>
      <td>0.951000</td>
      <td>0.1550</td>
      <td>0.1080</td>
    </tr>
    <tr>
      <th>9970</th>
      <td>45YTUUPFSm6GS6LsddwRmj</td>
      <td>Beautiful World (From "Darling in the FranXX")</td>
      <td>Fonzi M</td>
      <td>Anime Piano Music Collection in Spring, Vol. 2</td>
      <td>2018-04-20</td>
      <td>92282</td>
      <td>anime</td>
      <td>0.517</td>
      <td>0.3640</td>
      <td>4</td>
      <td>-16.545</td>
      <td>131.958</td>
      <td>4</td>
      <td>0.964000</td>
      <td>0.2300</td>
      <td>0.7260</td>
    </tr>
    <tr>
      <th>9971</th>
      <td>1DXSEjzzL5x9TybrYE2A3K</td>
      <td>Eminent (Soundtrack from the Anime "Black Butl...</td>
      <td>Rolelush</td>
      <td>Anime and Game on Piano</td>
      <td>2018-12-03</td>
      <td>80039</td>
      <td>anime</td>
      <td>0.323</td>
      <td>0.1690</td>
      <td>2</td>
      <td>-23.435</td>
      <td>117.083</td>
      <td>4</td>
      <td>0.844000</td>
      <td>0.2120</td>
      <td>0.0954</td>
    </tr>
    <tr>
      <th>9972</th>
      <td>1E65lXfTCueQizuL4z8knx</td>
      <td>A Silent Voice- Lit var - Koe no Katachi</td>
      <td>Otaku Muisc</td>
      <td>Opening Triste ,Vol.1</td>
      <td>2022-04-11</td>
      <td>150932</td>
      <td>anime</td>
      <td>0.386</td>
      <td>0.0448</td>
      <td>7</td>
      <td>-19.892</td>
      <td>88.128</td>
      <td>3</td>
      <td>0.958000</td>
      <td>0.1030</td>
      <td>0.0729</td>
    </tr>
    <tr>
      <th>9973</th>
      <td>1fDkKDjiAgVn3uQPpvdAPx</td>
      <td>Nabiki's Letter to Peace</td>
      <td>ChillHoop</td>
      <td>Anime Moonlight Vol. 2</td>
      <td>2024-07-12</td>
      <td>99000</td>
      <td>anime</td>
      <td>0.706</td>
      <td>0.1920</td>
      <td>9</td>
      <td>-18.031</td>
      <td>79.990</td>
      <td>4</td>
      <td>0.168000</td>
      <td>0.3070</td>
      <td>0.3240</td>
    </tr>
  </tbody>
</table>
<p>9974 rows  16 columns</p>
</div></div></div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="yprofiling">
<h1>YProfiling<a class="headerlink" href="#yprofiling" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">profile</span> <span class="o">=</span> <span class="n">ProfileReport</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Data Profiling Report&quot;</span><span class="p">,</span> <span class="n">explorative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">profile</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s2">&quot;data_profile_report.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "eb22944cfdad4123a48fd894eb32493e", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "a886f41840d64d65a2d74f76b465cd15", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "2d7c78a51bb94f9d95459cca354181b4", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "02477b2a11f7420d82b571bced541feb", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset Overview:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Summary Statistics:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset Overview:
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 9974 entries, 0 to 9973
Data columns (total 16 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   song_id           9974 non-null   object 
 1   title             9974 non-null   object 
 2   artist_name       9974 non-null   object 
 3   album_name        9974 non-null   object 
 4   release_date      9974 non-null   object 
 5   duration_ms       9974 non-null   int64  
 6   genre             9974 non-null   object 
 7   danceability      9974 non-null   float64
 8   energy            9974 non-null   float64
 9   key               9974 non-null   int64  
 10  loudness          9974 non-null   float64
 11  tempo             9974 non-null   float64
 12  time_signature    9974 non-null   int64  
 13  instrumentalness  9974 non-null   float64
 14  liveness          9974 non-null   float64
 15  valence           9974 non-null   float64
dtypes: float64(7), int64(3), object(6)
memory usage: 1.2+ MB
None

Summary Statistics:
        duration_ms  danceability       energy          key     loudness  \
count  9.974000e+03   9974.000000  9974.000000  9974.000000  9974.000000   
mean   1.966481e+05      0.577202     0.599220     5.176359   -10.504410   
std    1.006516e+05      0.181742     0.291608     3.611523     6.931081   
min    3.001400e+04      0.000000     0.000019     0.000000   -46.986000   
25%    1.384418e+05      0.457250     0.378000     2.000000   -13.141750   
50%    1.871130e+05      0.595000     0.652000     5.000000    -8.399500   
75%    2.348782e+05      0.714000     0.856000     8.000000    -5.730000   
max    3.600014e+06      0.985000     1.000000    11.000000     0.642000   

             tempo  time_signature  instrumentalness     liveness      valence  
count  9974.000000     9974.000000       9974.000000  9974.000000  9974.000000  
mean    121.377475        3.911169          0.354901     0.192766     0.465446  
std      30.005565        0.401703          0.408154     0.161523     0.261067  
min       0.000000        0.000000          0.000000     0.011400     0.000000  
25%      99.062750        4.000000          0.000005     0.098300     0.246000  
50%     120.982000        4.000000          0.034050     0.122000     0.452000  
75%     140.016000        4.000000          0.846000     0.242000     0.672750  
max     220.010000        5.000000          0.998000     0.991000     1.000000  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Missing Values:&quot;</span><span class="p">)</span>
<span class="n">missing_values</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">missing_values</span><span class="p">[</span><span class="n">missing_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Missing Values:
Series([], dtype: int64)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_corr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;song_id&#39;</span><span class="p">,</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;artist_name&#39;</span><span class="p">,</span><span class="s1">&#39;album_name&#39;</span><span class="p">,</span><span class="s1">&#39;release_date&#39;</span><span class="p">,</span><span class="s1">&#39;genre&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Correlation Matrix:&quot;</span><span class="p">)</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">data_corr</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation Matrix:
                  duration_ms  danceability    energy       key  loudness  \
duration_ms          1.000000     -0.117077  0.264456  0.023241  0.262563   
danceability        -0.117077      1.000000 -0.076999  0.040745  0.083217   
energy               0.264456     -0.076999  1.000000  0.045882  0.814548   
key                  0.023241      0.040745  0.045882  1.000000  0.034264   
loudness             0.262563      0.083217  0.814548  0.034264  1.000000   
tempo                0.014308     -0.032599  0.219012  0.004258  0.179318   
time_signature       0.023823      0.159767  0.148858  0.032779  0.152128   
instrumentalness    -0.136919     -0.104790 -0.354894 -0.017821 -0.519856   
liveness             0.088121     -0.143420  0.246784  0.006166  0.191247   
valence             -0.031537      0.435494  0.217385  0.041014  0.258035   

                     tempo  time_signature  instrumentalness  liveness  \
duration_ms       0.014308        0.023823         -0.136919  0.088121   
danceability     -0.032599        0.159767         -0.104790 -0.143420   
energy            0.219012        0.148858         -0.354894  0.246784   
key               0.004258        0.032779         -0.017821  0.006166   
loudness          0.179318        0.152128         -0.519856  0.191247   
tempo             1.000000        0.018850         -0.081819  0.028476   
time_signature    0.018850        1.000000         -0.081122  0.020311   
instrumentalness -0.081819       -0.081122          1.000000 -0.177141   
liveness          0.028476        0.020311         -0.177141  1.000000   
valence           0.104884        0.118652         -0.271413  0.030062   

                   valence  
duration_ms      -0.031537  
danceability      0.435494  
energy            0.217385  
key               0.041014  
loudness          0.258035  
tempo             0.104884  
time_signature    0.118652  
instrumentalness -0.271413  
liveness          0.030062  
valence           1.000000  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix Heatmap&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/771234947ed89e8f616d09e1292de1f384db47862d446af9e60d670859c59a33.png" src="../../_images/771234947ed89e8f616d09e1292de1f384db47862d446af9e60d670859c59a33.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identify capped values and distributions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Observing distributions and capped values:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distribution of </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Observing distributions and capped values:
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/b86ffaa650853179f5590ab6b26ec061ab1e48ad90d25d19354a34f06554ced9.png" src="../../_images/b86ffaa650853179f5590ab6b26ec061ab1e48ad90d25d19354a34f06554ced9.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/58fa704eccf459892cdd8d06d64c93d672c16e534a08584d9ae3170801a95869.png" src="../../_images/58fa704eccf459892cdd8d06d64c93d672c16e534a08584d9ae3170801a95869.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/b348c304294ef6d7ebc412fa0850f330f5f60e55e4fb14bbf5e56929d09500a5.png" src="../../_images/b348c304294ef6d7ebc412fa0850f330f5f60e55e4fb14bbf5e56929d09500a5.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/c2677c9200e5d5c23e1a7c841830ae432da4b7c7d3e58875afc380052456803b.png" src="../../_images/c2677c9200e5d5c23e1a7c841830ae432da4b7c7d3e58875afc380052456803b.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/3867083776508d8871ad62f7fee8ab9eedd401194d782aa20c15cfaa2c373bf4.png" src="../../_images/3867083776508d8871ad62f7fee8ab9eedd401194d782aa20c15cfaa2c373bf4.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/0173a576a59fe0ddf15c7a4f0f55b8150ae7053db7751262bd1867e5ba355461.png" src="../../_images/0173a576a59fe0ddf15c7a4f0f55b8150ae7053db7751262bd1867e5ba355461.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/c4ec911e8773471f58c56e30542992db3e08d816740e1326f06ce0c5e14520e7.png" src="../../_images/c4ec911e8773471f58c56e30542992db3e08d816740e1326f06ce0c5e14520e7.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/b72e65f324b4141c44bb785a32ca3f317e3c40358c91dc3aad7f69b02597d148.png" src="../../_images/b72e65f324b4141c44bb785a32ca3f317e3c40358c91dc3aad7f69b02597d148.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/c816cf6b9f6d833e94b92bff810822b7f1de63a4a0fafeb8c1b77913a44b8e26.png" src="../../_images/c816cf6b9f6d833e94b92bff810822b7f1de63a4a0fafeb8c1b77913a44b8e26.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\seaborn\_oldcore.py:1119: FutureWarning: use_inf_as_na option is deprecated and will be removed in a future version. Convert inf values to NaN before operating instead.
  with pd.option_context(&#39;mode.use_inf_as_na&#39;, True):
</pre></div>
</div>
<img alt="../../_images/c6fc95b800fdc7170ad9cf87c03cc8e211a81a9d7200f562b0bbe2a406bef363.png" src="../../_images/c6fc95b800fdc7170ad9cf87c03cc8e211a81a9d7200f562b0bbe2a406bef363.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cleanup_tasks</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">if</span> <span class="n">missing_values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">cleanup_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Handle missing values (imputation or removal).&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;int64&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">):</span>
        <span class="n">cleanup_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> appears to have capped values; investigate and address.&quot;</span><span class="p">)</span>

<span class="n">low_variance_features</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
<span class="p">]</span>
<span class="k">if</span> <span class="n">low_variance_features</span><span class="p">:</span>
    <span class="n">cleanup_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Low variance features found: </span><span class="si">{</span><span class="n">low_variance_features</span><span class="si">}</span><span class="s2">. Consider removal.&quot;</span><span class="p">)</span>

<span class="n">high_corr_pairs</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">high_corr_pairs</span> <span class="o">=</span> <span class="n">high_corr_pairs</span><span class="p">[</span><span class="n">high_corr_pairs</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">]</span>  
<span class="k">if</span> <span class="n">high_corr_pairs</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="p">:</span>
    <span class="n">cleanup_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Highly correlated features found; consider feature selection to address multicollinearity.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data Cleanup Tasks:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">cleanup_tasks</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data Cleanup Tasks:
- Column key appears to have capped values; investigate and address.
- Column time_signature appears to have capped values; investigate and address.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for capped values in &#39;key&#39;</span>
<span class="n">key_max</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">key_99th_percentile</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">)</span>
<span class="k">if</span> <span class="n">key_max</span> <span class="o">==</span> <span class="n">key_99th_percentile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;key&#39; is likely capped at </span><span class="si">{</span><span class="n">key_max</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="c1"># Check for capped values in &#39;time_signature&#39;</span>
<span class="n">time_signature_max</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time_signature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">time_signature_99th_percentile</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;time_signature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.99</span><span class="p">)</span>
<span class="k">if</span> <span class="n">time_signature_max</span> <span class="o">==</span> <span class="n">time_signature_99th_percentile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;time_signature&#39; is likely capped at </span><span class="si">{</span><span class="n">time_signature_max</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;key&#39; is likely capped at 11.
&#39;time_signature&#39; is likely capped at 5.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_loudness</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;loudness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>  
<span class="n">max_loudness</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;loudness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;normalized_loudness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;loudness&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_loudness</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_loudness</span> <span class="o">-</span> <span class="n">min_loudness</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">map_to_mood</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;valence&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.7</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Happy&quot;</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;valence&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.3</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Calm&quot;</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;valence&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.3</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;normalized_loudness&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span> 
        <span class="k">return</span> <span class="s2">&quot;Sad&quot;</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;tempo&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">130</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Energetic&quot;</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;instrumentalness&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Instrumental&quot;</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;liveness&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Live&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Neutral&quot;</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;mood&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">map_to_mood</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>song_id</th>
      <th>title</th>
      <th>artist_name</th>
      <th>album_name</th>
      <th>release_date</th>
      <th>duration_ms</th>
      <th>genre</th>
      <th>danceability</th>
      <th>energy</th>
      <th>key</th>
      <th>loudness</th>
      <th>tempo</th>
      <th>time_signature</th>
      <th>instrumentalness</th>
      <th>liveness</th>
      <th>valence</th>
      <th>normalized_loudness</th>
      <th>mood</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>57Pk2GU0ABFYBbbcgYxqki</td>
      <td>Popular - From "Wicked" Original Broadway Cast...</td>
      <td>Stephen Schwartz</td>
      <td>Wicked (Original Broadway Cast Recording / Del...</td>
      <td>2013-01-01</td>
      <td>224386</td>
      <td>pop</td>
      <td>0.711</td>
      <td>0.2280</td>
      <td>0</td>
      <td>-12.850</td>
      <td>88.714</td>
      <td>4</td>
      <td>0.000000</td>
      <td>0.1220</td>
      <td>0.5480</td>
      <td>0.716721</td>
      <td>Calm</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6WzRpISELf3YglGAh7TXcG</td>
      <td>Popular (with Playboi Carti &amp; Madonna) - From ...</td>
      <td>The Weeknd</td>
      <td>Popular (Music from the HBO Original Series)</td>
      <td>2023-06-02</td>
      <td>215466</td>
      <td>pop</td>
      <td>0.854</td>
      <td>0.6740</td>
      <td>1</td>
      <td>-6.230</td>
      <td>99.022</td>
      <td>4</td>
      <td>0.000085</td>
      <td>0.5090</td>
      <td>0.8480</td>
      <td>0.855715</td>
      <td>Happy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6z3HAUZpAyJ0ctsbAwAiw3</td>
      <td>Pop Muzik</td>
      <td>M</td>
      <td>Pop Muzik</td>
      <td>2022-06-03</td>
      <td>200682</td>
      <td>pop</td>
      <td>0.935</td>
      <td>0.8330</td>
      <td>1</td>
      <td>-7.493</td>
      <td>108.914</td>
      <td>4</td>
      <td>0.000016</td>
      <td>0.0792</td>
      <td>0.9670</td>
      <td>0.829197</td>
      <td>Happy</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6uFn47ACjqYkc0jADwEdj1</td>
      <td>Pop Out (feat. Lil Tjay)</td>
      <td>Polo G</td>
      <td>Die A Legend</td>
      <td>2019-06-07</td>
      <td>166560</td>
      <td>pop</td>
      <td>0.772</td>
      <td>0.6390</td>
      <td>1</td>
      <td>-7.119</td>
      <td>168.112</td>
      <td>4</td>
      <td>0.000000</td>
      <td>0.0698</td>
      <td>0.2610</td>
      <td>0.837050</td>
      <td>Neutral</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4GssB27iJeqmfGxS94Tfij</td>
      <td>Popular Monster</td>
      <td>Falling In Reverse</td>
      <td>Popular Monster</td>
      <td>2019-11-20</td>
      <td>220537</td>
      <td>pop</td>
      <td>0.461</td>
      <td>0.8970</td>
      <td>3</td>
      <td>-3.982</td>
      <td>165.107</td>
      <td>4</td>
      <td>0.000000</td>
      <td>0.0965</td>
      <td>0.3580</td>
      <td>0.902914</td>
      <td>Energetic</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9969</th>
      <td>4FmUrmRianI41BlO2RYhew</td>
      <td>She Was Here, Alone (From "Erased")</td>
      <td>LucasPianoRoom</td>
      <td>Anime Piano, Vol. 2</td>
      <td>2020-04-02</td>
      <td>140945</td>
      <td>anime</td>
      <td>0.442</td>
      <td>0.0593</td>
      <td>4</td>
      <td>-19.093</td>
      <td>62.987</td>
      <td>3</td>
      <td>0.951000</td>
      <td>0.1550</td>
      <td>0.1080</td>
      <td>0.585643</td>
      <td>Instrumental</td>
    </tr>
    <tr>
      <th>9970</th>
      <td>45YTUUPFSm6GS6LsddwRmj</td>
      <td>Beautiful World (From "Darling in the FranXX")</td>
      <td>Fonzi M</td>
      <td>Anime Piano Music Collection in Spring, Vol. 2</td>
      <td>2018-04-20</td>
      <td>92282</td>
      <td>anime</td>
      <td>0.517</td>
      <td>0.3640</td>
      <td>4</td>
      <td>-16.545</td>
      <td>131.958</td>
      <td>4</td>
      <td>0.964000</td>
      <td>0.2300</td>
      <td>0.7260</td>
      <td>0.639141</td>
      <td>Instrumental</td>
    </tr>
    <tr>
      <th>9971</th>
      <td>1DXSEjzzL5x9TybrYE2A3K</td>
      <td>Eminent (Soundtrack from the Anime "Black Butl...</td>
      <td>Rolelush</td>
      <td>Anime and Game on Piano</td>
      <td>2018-12-03</td>
      <td>80039</td>
      <td>anime</td>
      <td>0.323</td>
      <td>0.1690</td>
      <td>2</td>
      <td>-23.435</td>
      <td>117.083</td>
      <td>4</td>
      <td>0.844000</td>
      <td>0.2120</td>
      <td>0.0954</td>
      <td>0.494478</td>
      <td>Instrumental</td>
    </tr>
    <tr>
      <th>9972</th>
      <td>1E65lXfTCueQizuL4z8knx</td>
      <td>A Silent Voice- Lit var - Koe no Katachi</td>
      <td>Otaku Muisc</td>
      <td>Opening Triste ,Vol.1</td>
      <td>2022-04-11</td>
      <td>150932</td>
      <td>anime</td>
      <td>0.386</td>
      <td>0.0448</td>
      <td>7</td>
      <td>-19.892</td>
      <td>88.128</td>
      <td>3</td>
      <td>0.958000</td>
      <td>0.1030</td>
      <td>0.0729</td>
      <td>0.568867</td>
      <td>Instrumental</td>
    </tr>
    <tr>
      <th>9973</th>
      <td>1fDkKDjiAgVn3uQPpvdAPx</td>
      <td>Nabiki's Letter to Peace</td>
      <td>ChillHoop</td>
      <td>Anime Moonlight Vol. 2</td>
      <td>2024-07-12</td>
      <td>99000</td>
      <td>anime</td>
      <td>0.706</td>
      <td>0.1920</td>
      <td>9</td>
      <td>-18.031</td>
      <td>79.990</td>
      <td>4</td>
      <td>0.168000</td>
      <td>0.3070</td>
      <td>0.3240</td>
      <td>0.607941</td>
      <td>Calm</td>
    </tr>
  </tbody>
</table>
<p>9974 rows  18 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;song_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;6WzRpISELf3YglGAh7TXcG&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  song_id                                              title  \
1  6WzRpISELf3YglGAh7TXcG  Popular (with Playboi Carti &amp; Madonna) - From ...   

  artist_name                                    album_name release_date  \
1  The Weeknd  Popular (Music from the HBO Original Series)   2023-06-02   

   duration_ms genre  danceability  energy  key  loudness   tempo  \
1       215466   pop         0.854   0.674    1     -6.23  99.022   

   time_signature  instrumentalness  liveness  valence  normalized_loudness  \
1               4          0.000085     0.509    0.848             0.855715   

    mood  
1  Happy  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">genre_encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s2">&quot;genre&quot;</span><span class="p">]])</span>

<span class="n">genre_encoded_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">genre_encoded</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">encoder</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">([</span><span class="s2">&quot;genre&quot;</span><span class="p">]))</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">genre_encoded_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;song_id&#39;, &#39;title&#39;, &#39;artist_name&#39;, &#39;album_name&#39;, &#39;release_date&#39;,
       &#39;duration_ms&#39;, &#39;genre&#39;, &#39;danceability&#39;, &#39;energy&#39;, &#39;key&#39;, &#39;loudness&#39;,
       &#39;tempo&#39;, &#39;time_signature&#39;, &#39;instrumentalness&#39;, &#39;liveness&#39;, &#39;valence&#39;,
       &#39;normalized_loudness&#39;, &#39;mood&#39;, &#39;genre_Electronic&#39;, &#39;genre_Indie&#39;,
       &#39;genre_anime&#39;, &#39;genre_death-metal&#39;, &#39;genre_disco&#39;, &#39;genre_hard-rock&#39;,
       &#39;genre_holidays&#39;, &#39;genre_jazz&#39;, &#39;genre_pop&#39;, &#39;genre_rock&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;danceability&quot;</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_loudness&quot;</span><span class="p">,</span> <span class="s2">&quot;tempo&quot;</span><span class="p">,</span> <span class="s2">&quot;valence&quot;</span><span class="p">,</span> <span class="s2">&quot;instrumentalness&quot;</span><span class="p">,</span> <span class="s2">&quot;liveness&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mood&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="dagshub">
<h1>DagsHUB<a class="headerlink" href="#dagshub" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dagshub</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">repo_owner</span><span class="o">=</span><span class="s1">&#39;shahadeven&#39;</span><span class="p">,</span>
             <span class="n">repo_name</span><span class="o">=</span><span class="s1">&#39;503_Project&#39;</span><span class="p">,</span>
             <span class="n">mlflow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
  <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s1">&#39;parameter name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>
  <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s1">&#39;metric name&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Accessing as ShahaDeven
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Initialized MLflow to track repo <span style="color: #008000; text-decoration-color: #008000">"shahadeven/503_Project"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Repository shahadeven/503_Project initialized!
</pre>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> View run worried-stag-125 at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/0/runs/53ff07c3fca14de29f8beff7ceee16dc
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/shahadeven/503_Project.mlflow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">class_counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mood
Neutral         3790
Instrumental    2619
Happy           1513
Energetic        998
Calm             913
Live             100
Sad               41
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-1">
<h1>Experiment 1<a class="headerlink" href="#experiment-1" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  
    <span class="p">(</span><span class="s2">&quot;logreg&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;logreg__C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> 
    <span class="s2">&quot;logreg__solver&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;liblinear&quot;</span><span class="p">,</span> <span class="s2">&quot;saga&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">),</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Logistic Regression Experiment&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/7713aff20f354756937c9832eadb8167&#39;, creation_time=1734199833731, experiment_id=&#39;1&#39;, last_update_time=1734199833731, lifecycle_stage=&#39;active&#39;, name=&#39;Logistic Regression Experiment&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Experiment#1&quot;</span><span class="p">):</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_params</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Best CV F1-Score&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>

    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">test_f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_dict</span><span class="p">({</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="o">.</span><span class="n">tolist</span><span class="p">()},</span> <span class="s2">&quot;confusion_matrix.json&quot;</span><span class="p">)</span>

    <span class="n">classification_metrics</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span><span class="n">classification_metrics</span><span class="p">,</span> <span class="s2">&quot;classification_report.json&quot;</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Test F1-Score&quot;</span><span class="p">,</span> <span class="n">test_f1</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment logged in MLFlow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\sklearn\model_selection\_search.py:1107: UserWarning: One or more of the test scores are non-finite: [nan nan nan nan nan nan nan nan nan nan]
  warnings.warn(
d:\Main_Python\.venv\Lib\site-packages\sklearn\metrics\_classification.py:1565: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f&quot;{metric.capitalize()} is&quot;, len(result))
d:\Main_Python\.venv\Lib\site-packages\sklearn\metrics\_classification.py:1565: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f&quot;{metric.capitalize()} is&quot;, len(result))
d:\Main_Python\.venv\Lib\site-packages\sklearn\metrics\_classification.py:1565: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f&quot;{metric.capitalize()} is&quot;, len(result))
2024/12/16 22:28:52 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment logged in MLFlow.
 View run Experiment#1 at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/1/runs/d9a8f970bfda4ad7ae1594b194f3b75c
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/1
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-2">
<h1>Experiment 2<a class="headerlink" href="#experiment-2" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;Ridge Classifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;Random Forest&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment #2: Multiple Classifiers&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/2d3733742ef4465eb78270ccd9692b6d&#39;, creation_time=1734219042881, experiment_id=&#39;2&#39;, last_update_time=1734219042881, lifecycle_stage=&#39;active&#39;, name=&#39;Experiment #2: Multiple Classifiers&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">label_encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">y_encoded</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_encoder</span><span class="o">.</span><span class="n">classes_</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encoded value </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> -&gt; Class &#39;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Encoded value 0 -&gt; Class &#39;Calm&#39;
Encoded value 1 -&gt; Class &#39;Energetic&#39;
Encoded value 2 -&gt; Class &#39;Happy&#39;
Encoded value 3 -&gt; Class &#39;Instrumental&#39;
Encoded value 4 -&gt; Class &#39;Live&#39;
Encoded value 5 -&gt; Class &#39;Neutral&#39;
Encoded value 6 -&gt; Class &#39;Sad&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y_encoded</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">clf_name</span><span class="p">,</span> <span class="n">clf</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> Run&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running </span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">clf</span><span class="p">)</span>
        <span class="p">])</span>

        <span class="n">cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">))</span>
        <span class="n">mean_cv_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>
        <span class="n">std_cv_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>

        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

        <span class="n">test_f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">classwise_cm</span> <span class="o">=</span> <span class="n">multilabel_confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

            <span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">classwise_cm</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  
            <span class="n">fn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">classwise_cm</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> 
            <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">classwise_cm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> 
            <span class="n">tn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">classwise_cm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>  
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">test_mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">test_r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Test F1-Score&quot;</span><span class="p">,</span> <span class="n">test_f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Mean CV F1-Score&quot;</span><span class="p">,</span> <span class="n">mean_cv_score</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Std CV F1-Score&quot;</span><span class="p">,</span> <span class="n">std_cv_score</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Test MAE&quot;</span><span class="p">,</span> <span class="n">test_mae</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Test R Score&quot;</span><span class="p">,</span> <span class="n">test_r2</span><span class="p">)</span>

        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_dict</span><span class="p">({</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="o">.</span><span class="n">tolist</span><span class="p">()},</span> <span class="s2">&quot;confusion_matrix.json&quot;</span><span class="p">)</span>

        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">clf_name</span><span class="si">}</span><span class="s2"> logged in MLFlow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running Logistic Regression...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/16 22:45:29 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Logistic Regression logged in MLFlow.
 View run Logistic Regression Run at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/2/runs/dc3cefdbcf274f0ea8c057aa3ab12c47
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/2
Running Ridge Classifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/16 22:45:48 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ridge Classifier logged in MLFlow.
 View run Ridge Classifier Run at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/2/runs/1d3151dd72104fc592fe4bf08e710874
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/2
Running Random Forest...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/16 22:46:08 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Random Forest logged in MLFlow.
 View run Random Forest Run at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/2/runs/709f3c809b5f4b65aa535205e160def5
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/2
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-3">
<h1>Experiment 3<a class="headerlink" href="#experiment-3" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment #3: Feature Engineering&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/598d40f523074dceb2efda4f7acb5eb7&#39;, creation_time=1734238425337, experiment_id=&#39;3&#39;, last_update_time=1734238425337, lifecycle_stage=&#39;active&#39;, name=&#39;Experiment #3: Feature Engineering&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">feature_engineering</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
    <span class="n">X</span><span class="p">[</span><span class="s2">&quot;danceability_energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;danceability&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">]</span>
    <span class="n">X</span><span class="p">[</span><span class="s2">&quot;tempo_valence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;tempo&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;valence&quot;</span><span class="p">]</span>

    <span class="n">X</span><span class="p">[</span><span class="s2">&quot;mean_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[[</span><span class="s2">&quot;danceability&quot;</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;valence&quot;</span><span class="p">,</span> <span class="s2">&quot;liveness&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">X</span><span class="p">[</span><span class="s2">&quot;max_features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[[</span><span class="s2">&quot;danceability&quot;</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;valence&quot;</span><span class="p">,</span> <span class="s2">&quot;liveness&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">X</span><span class="p">[</span><span class="s2">&quot;normalized_loudness_squared&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s2">&quot;normalized_loudness&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_engineering</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">feature_engineering</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">feature_engineering</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">feature_engineering</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span> <span class="p">,</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;RandomForest Classifier Feature Engineering Experiment&quot;</span><span class="p">):</span>
    <span class="n">cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">make_scorer</span><span class="p">(</span><span class="n">f1_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">))</span>
    <span class="n">mean_cv_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>
    <span class="n">std_cv_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Mean CV F1-Score&quot;</span><span class="p">,</span> <span class="n">mean_cv_score</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Std CV F1-Score&quot;</span><span class="p">,</span> <span class="n">std_cv_score</span><span class="p">)</span>

    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    
    <span class="n">test_f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Test F1-Score&quot;</span><span class="p">,</span> <span class="n">test_f1</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>  
        <span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  
        <span class="n">fn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>  
        <span class="n">fp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>  
        <span class="n">tn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">fn</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>  

        <span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_dict</span><span class="p">({</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">:</span> <span class="n">cm</span><span class="o">.</span><span class="n">tolist</span><span class="p">()},</span> <span class="s2">&quot;confusion_matrix.json&quot;</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment logged in MLFlow with XGBoost.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature engineering complete. Results logged in MLFlow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/16 22:49:15 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment logged in MLFlow with XGBoost.
 View run RandomForest Classifier Feature Engineering Experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/3/runs/428942cb63aa42f792f1d5e6fc935e73
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/3
Feature engineering complete. Results logged in MLFlow.
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-4">
<h1>Experiment 4<a class="headerlink" href="#experiment-4" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment #4: Feature Selection&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/41bd9cd7b01c420baf3415c62db9f707&#39;, creation_time=1734281497810, experiment_id=&#39;4&#39;, last_update_time=1734281497810, lifecycle_stage=&#39;active&#39;, name=&#39;Experiment #4: Feature Selection&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">select_by_correlation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
    <span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
    <span class="n">upper_triangle</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">to_drop</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">upper_triangle</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">upper_triangle</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">to_drop</span><span class="p">),</span> <span class="n">to_drop</span>

<span class="k">def</span> <span class="nf">select_by_variance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">X_var</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">selected_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>
    <span class="n">dropped_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_var</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">selected_features</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">dropped_features</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">select_by_importance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">)</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">prefit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">X_imp</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">selected_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>
    <span class="n">dropped_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">selector</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">selected_features</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">dropped_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Feature_Selection_Experiment&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting feature selection experiment...&quot;</span><span class="p">)</span>

    <span class="n">initial_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">X_corr</span><span class="p">,</span> <span class="n">dropped_corr</span> <span class="o">=</span> <span class="n">select_by_correlation</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropped_Correlation_Threshold_0.8&quot;</span><span class="p">,</span> <span class="n">dropped_corr</span><span class="p">)</span>

    <span class="n">X_var</span><span class="p">,</span> <span class="n">dropped_var</span> <span class="o">=</span> <span class="n">select_by_variance</span><span class="p">(</span><span class="n">X_corr</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropped_Variance_Threshold_0.01&quot;</span><span class="p">,</span> <span class="n">dropped_var</span><span class="p">)</span>

    <span class="n">X_imp</span><span class="p">,</span> <span class="n">dropped_imp</span> <span class="o">=</span> <span class="n">select_by_importance</span><span class="p">(</span><span class="n">X_var</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dropped_Importance_Threshold_median&quot;</span><span class="p">,</span> <span class="n">dropped_imp</span><span class="p">)</span>

    <span class="n">final_features</span> <span class="o">=</span> <span class="n">X_imp</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Final_Selected_Features&quot;</span><span class="p">,</span> <span class="n">final_features</span><span class="p">)</span>

    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">eval_metric</span><span class="o">=</span><span class="s2">&quot;mlogloss&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
    <span class="p">])</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_imp</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature selection completed and logged in MLflow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting feature selection experiment...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\sklearn\utils\validation.py:2732: UserWarning: X has feature names, but SelectFromModel was fitted without feature names
  warnings.warn(
2024/12/16 22:50:28 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Feature selection completed and logged in MLflow.
 View run Feature_Selection_Experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/4/runs/b710a81e9b8948f09c1a97ce50fbd91f
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/4
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="expermient-5">
<h1>Expermient 5<a class="headerlink" href="#expermient-5" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment #5: PCA Dimensionality Reduction&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/67e9dfb354424a9d92daff14ca78a319&#39;, creation_time=1734283584232, experiment_id=&#39;5&#39;, last_update_time=1734283584232, lifecycle_stage=&#39;active&#39;, name=&#39;Experiment #5: PCA Dimensionality Reduction&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># #final features extracted from the above step</span>
<span class="c1"># final_selected_features = [&#39;danceability&#39;, &#39;energy&#39;, &#39;tempo&#39;, &#39;valence&#39;, &#39;instrumentalness&#39;, &#39;liveness&#39;]</span>

<span class="c1"># X_selected = X[final_selected_features]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="n">explained_variance</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">explained_variance</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scree Plot - Explained Variance by Each Component&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Principal Components&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Explained Variance Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">scree_plot_path</span> <span class="o">=</span> <span class="s2">&quot;D:</span><span class="se">\\</span><span class="s2">Main_Python</span><span class="se">\\</span><span class="s2">UB_ESDS</span><span class="se">\\</span><span class="s2">EAS503</span><span class="se">\\</span><span class="s2">scree_plot.png&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">scree_plot_path</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cumulative_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_variance</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">X_pca_selected</span> <span class="o">=</span> <span class="n">X_pca</span><span class="p">[:,</span> <span class="p">:</span><span class="n">n_components</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pca</span><span class="p">,</span> <span class="s2">&quot;D:</span><span class="se">\\</span><span class="s2">Main_Python</span><span class="se">\\</span><span class="s2">UB_ESDS</span><span class="se">\\</span><span class="s2">EAS503</span><span class="se">\\</span><span class="s2">pca_model.pkl&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;D:\\Main_Python\\UB_ESDS\\EAS503\\pca_model.pkl&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_pca_selected</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9974, 6)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_pca_selected</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;PCA Dimensionality Reduction Experiment&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting PCA and classification experiment...&quot;</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;Number of Components&quot;</span><span class="p">,</span> <span class="n">n_components</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">variance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">):</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Explained Variance - PC</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">variance</span><span class="p">)</span>
    
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">scree_plot_path</span><span class="p">)</span>

    <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>

    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;MAE&quot;</span><span class="p">,</span> <span class="n">mae</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PCA dimensionality reduction and classification experiment completed and logged in MLFlow.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting PCA and classification experiment...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/16 22:53:38 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PCA dimensionality reduction and classification experiment completed and logged in MLFlow.
 View run PCA Dimensionality Reduction Experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/5/runs/81fa2d4c8fee4fa6bbd7c771e406f7d5
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/5
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-6">
<h1>Experiment 6<a class="headerlink" href="#experiment-6" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment #6: Stacking Classifier&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/1053afc33af047a38ab2f2d5b0d980d8&#39;, creation_time=1734379520158, experiment_id=&#39;7&#39;, last_update_time=1734379520158, lifecycle_stage=&#39;active&#39;, name=&#39;Experiment #6: Stacking Classifier&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_learners</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;gb&#39;</span><span class="p">,</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;svm&#39;</span><span class="p">,</span> <span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">]</span>

<span class="n">stacking_clf</span> <span class="o">=</span> <span class="n">StackingClassifier</span><span class="p">(</span>
    <span class="n">estimators</span><span class="o">=</span><span class="n">base_learners</span><span class="p">,</span>
    <span class="n">final_estimator</span><span class="o">=</span><span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="n">cv</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;Stacking Classifier&quot;</span><span class="p">):</span>
    <span class="c1"># Fit the stacking classifier</span>
    <span class="n">stacking_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">stacking_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    
    <span class="c1"># Log F1-score</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>

    <span class="n">class_report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">report_path</span> <span class="o">=</span> <span class="s2">&quot;classification_report.txt&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">class_report</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">report_path</span><span class="p">)</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">cm_plot_path</span> <span class="o">=</span> <span class="s2">&quot;confusion_matrix.png&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predicted Labels&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;True Labels&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">cm_plot_path</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">cm_plot_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>  
        <span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
        <span class="n">tn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">fn</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>  
        <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Positives&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Positives&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;False Negatives&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;True Negatives&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">stacking_clf</span><span class="p">,</span> <span class="s2">&quot;stacking_model&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/16 23:04:10 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> View run Stacking Classifier at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/7/runs/65a62d631e78429a8e8385a8631629b6
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/7
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="experiment-7">
<h1>Experiment 7<a class="headerlink" href="#experiment-7" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Experiment #7: Smote Analysis&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/18 15:44:17 INFO mlflow.tracking.fluent: Experiment with name &#39;Experiment #7: Smote Analysis&#39; does not exist. Creating a new experiment.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/127899f2737c40efb24615306072052c&#39;, creation_time=1734554655768, experiment_id=&#39;9&#39;, last_update_time=1734554655768, lifecycle_stage=&#39;active&#39;, name=&#39;Experiment #7: Smote Analysis&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">&quot;danceability&quot;</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;normalized_loudness&quot;</span><span class="p">,</span> <span class="s2">&quot;tempo&quot;</span><span class="p">,</span> <span class="s2">&quot;valence&quot;</span><span class="p">,</span> <span class="s2">&quot;instrumentalness&quot;</span><span class="p">,</span> <span class="s2">&quot;liveness&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;mood&quot;</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">smote</span> <span class="o">=</span> <span class="n">SMOTE</span><span class="p">(</span><span class="n">sampling_strategy</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">X_train_res</span><span class="p">,</span> <span class="n">y_train_res</span> <span class="o">=</span> <span class="n">smote</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_res</span><span class="p">,</span> <span class="n">y_train_res</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy:&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Classification Report:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">report</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Class Distribution Before SMOTE&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Class&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">y_train_res</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Class Distribution After SMOTE&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Class&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;class_distribution.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy: 0.9953224189776144
Classification Report:
               precision    recall  f1-score   support

        Calm       1.00      1.00      1.00       307
   Energetic       1.00      0.97      0.98       285
       Happy       1.00      1.00      1.00       478
Instrumental       0.99      1.00      1.00       775
        Live       0.97      0.93      0.95        30
     Neutral       0.99      1.00      1.00      1106
         Sad       1.00      1.00      1.00        12

    accuracy                           1.00      2993
   macro avg       0.99      0.99      0.99      2993
weighted avg       1.00      1.00      1.00      2993
</pre></div>
</div>
<img alt="../../_images/fe98ddff7d485e8c59bfeca2a0c613149e3ab8a88f83c332ea15f7fa6555868e.png" src="../../_images/fe98ddff7d485e8c59bfeca2a0c613149e3ab8a88f83c332ea15f7fa6555868e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;RandomForestClassifier with SMOTE&quot;</span><span class="p">):</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;RandomForestClassifier with SMOTE&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;smote_sampling_strategy&quot;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;classification_report.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;classification_report.txt&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;class_distribution.png&quot;</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;random_forest_model_with_smote&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/18 15:49:30 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> View run RandomForestClassifier with SMOTE at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/9/runs/5e3036ceb0324cfe82a41ecbeccddb02
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/9
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="f1-score-plots">
<h1>F1 Score Plots<a class="headerlink" href="#f1-score-plots" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;F1 Score Plots&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Experiment: artifact_location=&#39;mlflow-artifacts:/b22a23fbd9474d0abb8d7c565fec559d&#39;, creation_time=1734384290893, experiment_id=&#39;8&#39;, last_update_time=1734384290893, lifecycle_stage=&#39;active&#39;, name=&#39;F1 Score Plots&#39;, tags={}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Stacked Classifier&quot;</span><span class="p">:</span> <span class="n">stacking_clf</span><span class="p">,</span>  
    <span class="s2">&quot;Logistic Regression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>  
    <span class="s2">&quot;Ridge Classifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;Random Forest&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;SVM&quot;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f1_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">experiment_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="s2">&quot;F1 Score Comparison Overall&quot;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">experiment_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="n">experiment_name</span><span class="p">,</span> <span class="n">nested</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

            <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

            <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
            <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;F1 Score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>

            <span class="n">f1_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">experiment_names</span><span class="p">,</span> <span class="n">f1_scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Experiments&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;F1-Score&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of F1-Scores Across Experiments&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="n">comparison_plot_path</span> <span class="o">=</span> <span class="s2">&quot;f1_score_comparison.png&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">comparison_plot_path</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="n">comparison_plot_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> View run Stacked Classifier at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8/runs/e9aadd02253b4b089f463640c17a03c9
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>d:\Main_Python\.venv\Lib\site-packages\sklearn\linear_model\_logistic.py:465: ConvergenceWarning: lbfgs failed to converge (status=1):
STOP: TOTAL NO. of ITERATIONS REACHED LIMIT.

Increase the number of iterations (max_iter) or scale the data as shown in:
    https://scikit-learn.org/stable/modules/preprocessing.html
Please also refer to the documentation for alternative solver options:
    https://scikit-learn.org/stable/modules/linear_model.html#logistic-regression
  n_iter_i = _check_optimize_result(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> View run Logistic Regression at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8/runs/9bf27602143041d7882ca6aa24301694
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8
 View run Ridge Classifier at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8/runs/cadd3664a2674033a00f2e734b7edd9e
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8
 View run Random Forest at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8/runs/f492437017d942fdaecc4dd470ec2c96
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8
 View run SVM at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8/runs/60e4d6e6f9944a91a6661f534365933d
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8
 View run F1 Score Comparison Overall at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8/runs/3f5ec1f6ae744f89b6ec3a36974f2268
 View experiment at: https://dagshub.com/shahadeven/503_Project.mlflow/#/experiments/8
</pre></div>
</div>
</div>
</div>
<section id="save-model-using-joblib">
<h2>Save model using joblib<a class="headerlink" href="#save-model-using-joblib" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span>  <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_encoded</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rf_model</span> <span class="o">=</span> <span class="n">model</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="s1">&#39;random_forest_model.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;random_forest_model.pkl&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content\notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../code_section.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Code Files</p>
      </div>
    </a>
    <a class="right-next"
       href="FastAPI.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">FastAPI Code</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Code</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#to-fetch-inital-1k-songs">To fetch inital 1k songs</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sample-output-of-data-being-fetched">Sample Output of Data Being Fetched</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#to-fetch-remaining-9k-songs">to fetch remaining 9k songs</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Sample Output of Data Being Fetched</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#merge-songs">Merge songs</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sqlite3-connection">SQLITE3 Connection</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-schema">Table schema</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nf">3NF</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#yprofiling">YProfiling</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dagshub">DagsHUB</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-1">Experiment 1</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-2">Experiment 2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-3">Experiment 3</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-4">Experiment 4</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#expermient-5">Expermient 5</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-6">Experiment 6</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#experiment-7">Experiment 7</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#f1-score-plots">F1 Score Plots</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#save-model-using-joblib">Save model using joblib</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Deven Rahul Shah
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>